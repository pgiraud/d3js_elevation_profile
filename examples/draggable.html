<!DOCTYPE html>
<meta charset="utf-8">
<body>
  <style>

    #initial {
      display: none;
    }
    #final {
      cursor: ew-resize;
      cursor: grab;
      cursor: -webkit-grab;
      cursor: -ms-grab;
    }

  </style>
<!-- <button id="export">Export as SVG</button> -->
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://eligrey.com/demos/FileSaver.js/Blob.js"></script>
<script src="http://eligrey.com/demos/FileSaver.js/FileSaver.js"></script>
<script>
 function toomanydata() {
    var margin = { 'left' : 30, 'bottom' : 20, 'top' : 15, 'right' : 240 },
        width = 960,
        height = 135,
        w = width - margin.left - margin.right,
        h = height - margin.top - margin.bottom,
        xscale = d3.scale.linear().domain([0, w]).range([0, w]),
        yscale = d3.scale.linear().domain([0, h]).range([h, 0]),
        xaxis = d3.svg.axis().scale(xscale).orient('bottom'),
        yaxis = d3.svg.axis().scale(yscale).orient('left').tickValues(d3.range(0, 101, 20)),
        clip = null;

    function rescale() {
      xscale.domain([0, w = width - margin.left - margin.right]).range([0, w]);
      yscale.domain([0, h = height - margin.top - margin.bottom]).range([h, 0]);
    }

    var line = d3.svg.line()
        .x(function(d) { return xscale(d[0]); })
        .y(function(d) { return yscale(d[1]); })
        .interpolate('basis');

    var bisect = d3.bisector(function(d) { return d[0]; });

    function chart(selection) { 
      selection.each(function(data) {
        var svg = d3.select(this).selectAll('svg')
            .data([data.points])
            .attr('width', width)
            .attr('height', height)
            .style('font-family', '"Helvetica Neue", Helvetica, Aria, sans-serif')
            .style('font-size', '10px')
        var svge = svg.enter()
          .append('svg')
            .attr('width', width)
            .attr('height', height)
            .style('font-family', '"Helvetica Neue", Helvetica, Aria, sans-serif')
            .style('font-size', '10px')
          .append('g')
            .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

        svge.append('g')
            .attr('class', 'x axis')

        svg.select('g.x.axis')
            .attr('transform', 'translate(0, ' + h + ')')

        svge.append('g')
            .attr('class', 'y axis')
        var idx = bisect.left(data.points, w);

        svge.append('g')
            .attr('clip-path', clip)
          .selectAll('path.data')
            .data([data.points.slice(0, idx), data.points.slice(idx - 1)])
            .style('fill', 'transparent')
            .style('stroke', 'grey')
            .style('stroke'-width, '2')
          .enter().append('path')
            .attr('class', function(d, i) { return 'data data-' + i; })
            .style('fill', 'transparent')
            .style('stroke', 'grey')
            .style('stroke'-width, '2')

        svge.append('g')
            .attr('class', 'left anchor');

        svge.append('g')
            .attr('class', 'right anchor');

        svg.select('g.right.anchor')
            .attr('transform', 'translate(' + w + ', 0)');

        svg.selectAll('.x.axis').call(xaxis)
        svg.selectAll('.y.axis').call(yaxis)
        svg.selectAll('.data').attr('d', line);
        svg.selectAll('.axis path, .axis line')
            .style('fill', 'none')
            .style('stroke', 'black')
            .style('shape-rendering', 'crispEdges');
      });
    }
chart.margin_right = function(m) {
      if (!arguments.length) return margin.right;
      margin.right = m;
      rescale();
      return chart;
    };

    chart.height = function(h) {
      if (!arguments.length) return height;
      height = h;
      rescale();
      return chart;
    };

    chart.width = function(w) {
      if (!arguments.length) return width;
      width = w;
      rescale();
      return chart;
    };

    chart.view_width = function() {
      return w;
    };

    chart.xscale = function(xs) {
      if (!arguments.length) return xscale;
      xscale = xs;
      rescale();
      return chart;
    };
    
    chart.clip = function(c) {
      if (!arguments.length) return clip;
      clip = c;
      return chart;
    };

    return chart;
  }
</script>
<div class='panning chart' id='initial'></div>
<div class='panning chart' id='final'></div>
<script>
  var random = d3.random.irwinHall(10);
  var points = d3.range(0, 928, 8).map(function(e) {
    return [e, (e / 1000.0) * 30 + 10 * random()];
  }),
  setup = d3.range(0, 3).map(function() {
    var chart = toomanydata()
    .clip('url(#clipper)');
    return { 'points' : points, 'chart' : chart };
  }),
  max = d3.max(points, function(d) { return d[0]; });

  var defs = d3.select('body')
  .append('svg')
  .attr('width', 0)
  .attr('height', 0)
  .append('defs');

  defs.append('clipPath')
  .attr('id', 'clipper')
  .append('rect')
  .attr('x', 0)
  .attr('y', 0)
  .attr('width', 960)
  .attr('height', 100);

  d3.selectAll('#initial, #no-bounds, #final')
  .data(setup)
  .each(function(datum) {
    d3.select(this).call(datum.chart)
  });

  d3.select('#initial').each(function(datum) {
    var ra = d3.select(this).select('svg g.right.anchor');

//    ra.append('line')
//    .attr('class', 'cutoff')
//    .attr('x1', 0)
//    .attr('y1', 0)
//    .attr('x2', 0)
//    .attr('y2', 100)
//    .attr('stroke-dasharray', '5, 2, 2');
  });

  d3.selectAll('#no-bounds, #final').each(function(datum) {
    var selection = d3.select(this);

    selection.call(datum.chart.width(720).margin_right(0));

    datum.zoom = d3.behavior.zoom()
    .x(datum.chart.xscale())
    .scaleExtent([1, 1])
    .on('zoom', function() {
      selection.call(datum.chart);
    });

    selection.select('svg')
    .call(datum.zoom)
    .on("mousewheel.zoom", null)
    .on("DOMMouseScroll.zoom", null);
  });

  d3.select('#final').call(function(selection) {
    var datum = selection.datum();

    datum.zoom.on('zoom', function() {
      var t = datum.zoom.translate(),
      dx = Math.min(0, Math.max(t[0], datum.chart.view_width() - max)),
      dy = t[1];

      datum.zoom.translate([dx, dy]);
      selection.call(datum.chart);
    });
  });

    d3.select('#export').on('click', function() {
        var txt =  d3.select("#initial svg")
            .attr("version", 1.1)
            .attr("xmlns", "http://www.w3.org/2000/svg")
            .node().parentNode.innerHTML;
        var blob = new Blob([txt], {type: "image/svg+xml"});
        saveAs(blob, "myProfile.svg");
    });
</script>
